<!DOCTYPE html>
<html lang="mr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO Meta Tags -->
    <title>Job Details | Majha Job Portal</title>
    <!-- We will update SEO tags dynamically via JS if needed, but for better SEO, Server Side Rendering is preferred. 
         For this static setup, these are placeholders. -->

    <link href="https://fonts.googleapis.com/css2?family=Mukta:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <header>
        <div class="container">
            <nav>
                <a href="index.html" class="logo">‡§Æ‡§æ‡§ù‡§æ ‡§ú‡•â‡§¨ ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤</a>
                <div class="nav-links">
                    <a href="index.html">‡§Æ‡•Å‡§ñ‡•ç‡§Ø‡§™‡•É‡§∑‡•ç‡§†</a>
                    <a href="#">‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§®‡•ã‡§ï‡§∞‡•Ä</a>
                </div>
            </nav>
        </div>
    </header>

    <div class="container">
        <!-- Top Ad -->
        <div class="ad-banner">
            Google AdSense - Leaderboard
        </div>

        <div class="main-content">
            <main class="left-column">
                <div id="job-detail-container" class="job-detail-box">
                    <div style="text-align:center; padding: 40px;">
                        Loading job details...
                    </div>
                </div>
            </main>

            <aside class="sidebar">
                <div class="ad-sidebar">
                    Google AdSense - Sidebar
                </div>

                <div class="job-card">
                    <h3>‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§á‡§§‡§∞ ‡§®‡•ã‡§ï‡§±‡•ç‡§Ø‡§æ</h3>
                    <ul style="padding-left: 20px;">
                        <li><a href="index.html">‡§Æ‡•Å‡§ñ‡•ç‡§Ø‡§™‡•É‡§∑‡•ç‡§† ‡§™‡§π‡§æ</a></li>
                    </ul>
                </div>
            </aside>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2025 ‡§Æ‡§æ‡§ù‡§æ ‡§ú‡•â‡§¨ ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤.</p>
        </div>
    </footer>

    <!-- Script to Load Job Details -->
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const container = document.getElementById('job-detail-container');

            // Get ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const jobId = urlParams.get('id');

            if (!jobId) {
                container.innerHTML = '<p style="text-align:center;">Job ID missing. <a href="index.html">Go Home</a></p>';
                return;
            }

            try {
                // Fetch Fetails
                // We reuse the manageJobs API. Ideally, we should have a specific endpoint for single job,
                // but for now we can filter the list or update the API to support ?id=X
                // Currently, let's fetch list and find (simple for MVP) 
                // OR better: Update API to support fetching single ID (Best Practice).
                // Let's assume we fetch all and find for now to keep it simple without changing Backend yet,
                // BUT for performance, backend should handle this.
                // Let's UPDATE THE API REQUEST to support ID.

                // NOTE: Since we haven't updated the backend to filter by ID in the GET request yet,
                // we will fetch all and filter client side. This is okay for small apps.
                const response = await fetch('/.netlify/functions/manageJobs');
                const jobs = await response.json();

                const job = jobs.find(j => j.id == jobId);

                if (!job) {
                    container.innerHTML = '<p style="text-align:center;">Job not found. <a href="index.html">Go Home</a></p>';
                    return;
                }

                // Update Page Title
                document.title = `${job.title} - Majha Job Portal`;

                // Render Content
                container.innerHTML = `
                    <h1 class="job-title">${escapeHtml(job.title)}</h1>
                    <p class="meta-info">üìÖ Last Date: ${job.last_date} | üìç ${escapeHtml(job.location)}</p>

                    <div class="ad-banner" style="height: auto; min-height: 90px; margin: 10px 0;">
                        Google AdSense - Article Top
                    </div>

                    <p><strong>${escapeHtml(job.department)}</strong> has announced a new recruitment drive.</p>
                    
                    <h2>Overview</h2>
                    <table class="info-table">
                        <tr><th>Department</th><td>${escapeHtml(job.department)}</td></tr>
                        <tr><th>Post Name</th><td>${escapeHtml(job.title)}</td></tr>
                        <tr><th>Vacancy</th><td>${escapeHtml(job.vacancy)}</td></tr>
                        <tr><th>Location</th><td>${escapeHtml(job.location)}</td></tr>
                        <tr><th>Salary</th><td>${escapeHtml(job.salary)}</td></tr>
                        <tr><th>Last Date</th><td>${job.last_date}</td></tr>
                    </table>

                     <h2>Full Description</h2>
                    <div style="line-height:1.8;">
                        ${job.full_desc ? job.full_desc.replace(/\n/g, '<br>') : 'No details provided.'}
                    </div>

                    <div style="text-align: center; margin: 30px 0;">
                        <a href="https://api.whatsapp.com/send?text=*${encodeURIComponent(job.title)}*%0A%0APlease check: ${window.location.href}"
                           target="_blank" class="share-btn-whatsapp">
                            üì± Share on WhatsApp
                        </a>
                    </div>

                    <div style="text-align: center; margin-top: 20px;">
                        <a href="${job.apply_link}" target="_blank" class="btn-read" style="padding: 15px 30px; font-size: 1.1rem; cursor: pointer;">
                            Apply Online Now (Link)
                        </a>
                    </div>
                `;

            } catch (error) {
                console.error(error);
                container.innerHTML = '<p style="text-align:center; color:red;">Error loading details.</p>';
            }
        });

        function escapeHtml(text) {
            if (!text) return '';
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
    </script>

</body>

</html>