<!DOCTYPE html>
<html lang="mr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO Meta Tags -->
    <title>Job Details | Majha Job Portal</title>
    <!-- We will update SEO tags dynamically via JS if needed, but for better SEO, Server Side Rendering is preferred. 
         For this static setup, these are placeholders. -->

    <link href="https://fonts.googleapis.com/css2?family=Mukta:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>

    <!-- Top Utility Bar -->
    <div class="top-bar">
        <div class="container">
            <span id="currentDate"></span>
            <div class="social-tiny">
                <a href="coming-soon.html" style="color:#666; margin-left:10px;"><i class="fab fa-facebook"></i></a>
                <a href="coming-soon.html" style="color:#666; margin-left:10px;"><i class="fab fa-twitter"></i></a>
                <a href="coming-soon.html" style="color:#666; margin-left:10px;"><i class="fab fa-instagram"></i></a>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-inner">
                <a href="index.html" class="logo">
                    <img src="weblogo.png" alt="MahaJobPortal Logo">
                </a>
                <!-- Optional Header Ad Slot -->
                <div class="header-ad"></div>
            </div>
        </div>
    </header>

    <!-- Sticky Navigation -->
    <nav class="main-nav">
        <div class="container">
            <ul class="nav-list">
                <li><a href="index.html"><i class="fas fa-home"></i> मुख्यपृष्ठ</a></li>
                <li><a href="coming-soon.html">नवीन जाहिराती</a></li>
                <li><a href="coming-soon.html">प्रवेशपत्र (Admit Card)</a></li>
                <li><a href="coming-soon.html">निकाल (Results)</a></li>
                <li><a href="coming-soon.html">अभ्यासक्रम (Syllabus)</a></li>
                <li><a href="coming-soon.html">वर्तमान नोकरी</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">

        <!-- Breadcrumb -->
        <div style="padding: 15px 0; font-size: 0.9rem; color: var(--text-light);">
            <a href="index.html" style="text-decoration:none; color:var(--text-light);">Home</a> <i
                class="fas fa-angle-right" style="font-size:0.8rem; margin:0 5px;"></i>
            <span style="color:var(--secondary-color);">Job Details</span>
        </div>

        <!-- Top Ad (Leaderboard) -->
        <div class="ad-slot-container">
            <div class="ad-label">Advertisement</div>
            <div class="ad-banner ad-placeholder">
                <span>Top Banner (728x90)</span>
            </div>
        </div>

        <div class="portal-grid">

            <!-- Main Content Area -->
            <main>
                <!-- Dynamic Content Container -->
                <div id="job-detail-container" class="job-detail-box">
                    <div style="text-align:center; padding: 40px;">
                        <i class="fas fa-spinner fa-spin" style="font-size:2rem; color:var(--primary-color);"></i>
                        <p style="margin-top:10px;">Loading job details...</p>
                    </div>
                </div>

                <!-- In-Feed Ad Slot (Below Content) -->
                <div class="ad-slot-container" style="margin-top: 30px;">
                    <div class="ad-label">Advertisement</div>
                    <div class="ad-banner ad-placeholder">
                        <span>Bottom Content Ad</span>
                    </div>
                </div>
            </main>

            <!-- Sidebar -->
            <aside>
                <!-- Sidebar Ad 1 -->
                <div class="ad-slot-container">
                    <div class="ad-label">Sponsored</div>
                    <div class="ad-sidebar ad-placeholder">
                        <span>Sidebar Ad 1 (300x250)</span>
                    </div>
                </div>

                <!-- WhatsApp Widget -->
                <div class="sidebar-widget">
                    <div class="widget-title"><i class="fab fa-whatsapp"></i> WhatsApp Updates</div>
                    <div class="widget-body">
                        <div class="whatsapp-box">
                            <p style="margin:0 0 10px; font-weight:600; color:#333;">Get Daily Job Updates on WhatsApp!
                            </p>
                            <a href="#" class="whatsapp-btn">Join Now</a>
                        </div>
                    </div>
                </div>

                <!-- Important Links -->
                <div class="sidebar-widget">
                    <div class="widget-title"><i class="fas fa-link"></i> महत्त्वपूर्ण लिंक्स</div>
                    <div class="widget-body" style="padding:0;">
                        <a href="coming-soon.html" class="highlight-link"><i class="fas fa-angle-right"></i> Hall Ticket
                            Download</a>
                        <a href="coming-soon.html" class="highlight-link"><i class="fas fa-angle-right"></i> Current
                            Affairs 2025</a>
                    </div>
                </div>

                <!-- Sidebar Ad 2 -->
                <div class="ad-slot-container">
                    <div class="ad-label">Advertisement</div>
                    <div class="ad-sidebar ad-placeholder">
                        <span>Sidebar Ad 2 (300x600)</span>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="copyright">
                <p>&copy; 2025 माझा जॉब पोर्टल. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Script to Load Job Details -->
    <script>
        // Set Date in Top Bar
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        const dateEl = document.getElementById('currentDate');
        if (dateEl) dateEl.innerText = new Date().toLocaleDateString('mr-IN', options);

        document.addEventListener("DOMContentLoaded", async () => {
            const container = document.getElementById("job-detail-container");

            // Get ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const jobId = urlParams.get('id');

            if (!jobId) {
                container.innerHTML = '<div style="text-align:center; padding:50px;">Job ID missing. <a href="index.html" class="btn-details">Go Home</a></div>';
                return;
            }

            // --- Load Custom Ads ---
            if (typeof applyCustomAds === 'function') setTimeout(applyCustomAds, 500);

            try {
                let jobs = [];

                // 1. Try Fetching from Server
                try {
                    const response = await fetch('/.netlify/functions/manageJobs');
                    if (!response.ok) throw new Error("Backend connection failed");
                    jobs = await response.json();
                } catch (fetchErr) {
                    // 2. Fallback to Local Storage
                    const localData = localStorage.getItem('mock_jobs_db');
                    if (localData) {
                        jobs = JSON.parse(localData);
                    } else {
                        throw new Error("Job not found.");
                    }
                }

                const job = jobs.find(j => j.id == jobId);

                if (!job) {
                    container.innerHTML = '<div style="text-align:center; padding:50px;">Job not found. <a href="index.html">Go Home</a></div>';
                    return;
                }

                // Update Page Title
                document.title = `${job.title} - Majha Job Portal`;

                // Render Content
                const lastDate = job.last_date ? new Date(job.last_date).toLocaleDateString('mr-IN') : 'N/A';

                container.innerHTML = `
                <div class="job-article-header" style="border-bottom: 2px solid #eee; padding-bottom: 20px; margin-bottom: 25px;">
                    <span style="background:var(--secondary-color); color:white; padding:3px 10px; border-radius:4px; font-size:0.8rem; text-transform:uppercase; letter-spacing:1px; margin-bottom:10px; display:inline-block;"> Recruitment 2025</span>
                    <h1 class="job-title-large" style="margin: 10px 0;">${escapeHtml(job.title)}</h1>
                    <div style="color:var(--text-light); font-size:0.9rem;">
                        <span style="margin-right:15px;"><i class="fas fa-building" style="color:var(--primary-color);"></i> ${escapeHtml(job.department)}</span>
                        <span><i class="far fa-clock" style="color:var(--primary-color);"></i> Last Date: ${lastDate}</span>
                    </div>
                </div>

                <!-- Internal Article Ad -->
                <div class="ad-slot-container" style="margin:20px 0;">
                    <div class="ad-banner ad-placeholder"><span>Article Top Ad</span></div>
                </div>

                <div class="article-content" style="font-size:1.05rem; line-height:1.7; color:#333;">
                    <p class="highlight-text" style="background:#e3f2fd; padding:15px; border-left:4px solid var(--secondary-color); border-radius:4px; font-style:italic;">
                        <strong>Short Description:</strong> ${escapeHtml(job.short_desc)}
                    </p>

                    <p><strong>${escapeHtml(job.department)}</strong> is inviting applications for the post of <strong>${escapeHtml(job.title)}</strong>. Interested candidates can apply before <strong>${lastDate}</strong>.</p>
                    
                    <h3 class="section-title">Job Overview</h3>
                    <table class="info-table" style="width:100%; border-collapse:collapse; margin:20px 0;">
                        <tr style="border-bottom:1px solid #ddd;"><th style="padding:12px; background:#f8f9fa; width:30%; text-align:left;">Department</th><td style="padding:12px;">${escapeHtml(job.department)}</td></tr>
                        <tr style="border-bottom:1px solid #ddd;"><th style="padding:12px; background:#f8f9fa; text-align:left;">Total Vacancy</th><td style="padding:12px;"><strong>${escapeHtml(job.vacancy)}</strong></td></tr>
                        <tr style="border-bottom:1px solid #ddd;"><th style="padding:12px; background:#f8f9fa; text-align:left;">Location</th><td style="padding:12px;">${escapeHtml(job.location)}</td></tr>
                        <tr style="border-bottom:1px solid #ddd;"><th style="padding:12px; background:#f8f9fa; text-align:left;">Salary (Pay Scale)</th><td style="padding:12px;">${escapeHtml(job.salary)}</td></tr>
                        <tr style="border-bottom:1px solid #ddd;"><th style="padding:12px; background:#f8f9fa; text-align:left;">Last Date</th><td style="padding:12px; color:var(--accent-color); font-weight:bold;">${lastDate}</td></tr>
                    </table>

                    <h3 class="section-title">Full Details & Eligibility</h3>
                     <div style="background:#fff; padding:15px; border:1px solid #eee; border-radius:4px;">
                        ${job.full_desc ? job.full_desc.replace(/\n/g, '<br>') : 'Refer to official notification for full details.'}
                    </div>

                    <!-- CTA Section -->
                    <h3 class="section-title">Important Links</h3>
                    <div style="display:grid; gap:15px; grid-template-columns: 1fr; margin-top:20px;">
                         <a href="${job.apply_link}" target="_blank" class="btn-read" style="text-align:center; padding:15px; background:var(--secondary-color); font-size:1.1rem; text-decoration:none; color:white;">
                            <i class="fas fa-mouse-pointer"></i> Apply Online Now
                        </a>
                       
                    </div>

                     <div style="margin-top: 40px; text-align:center; padding:20px; background:#f0f4c3; border-radius:8px;">
                        <h4 style="margin-top:0;">Share Job with Friends</h4>
                        <a href="https://api.whatsapp.com/send?text=*${encodeURIComponent(job.title)}*%0A%0AApply Here: ${window.location.href}"
                           target="_blank" class="share-btn-whatsapp" style="display:inline-block; width:auto; padding:10px 25px; text-decoration:none; color:green;">
                            <i class="fab fa-whatsapp"></i> Share on WhatsApp
                        </a>
                    </div>
                </div>
            `;

            } catch (error) {
                console.error(error);
                container.innerHTML = '<div style="text-align:center; padding:50px; color:red;"><h3>Error Loading Job</h3><p>Ensure you have added jobs via Admin Panel.</p></div>';
            }
        });

        function escapeHtml(text) {
            if (!text) return '';
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // --- Custom Ads Logic (Copied from index.html) ---
        function applyCustomAds() {
            const adsConfig = JSON.parse(localStorage.getItem('site_ads_config') || '{}');

            const replaceAd = (containerClass, imgData, index = 0) => {
                if (!imgData) return;
                const els = document.querySelectorAll(containerClass);
                if (els[index]) {
                    const img = document.createElement('img');
                    img.src = imgData;
                    img.style.width = '100%';
                    img.style.height = 'auto';
                    img.style.borderRadius = '4px';

                    els[index].innerHTML = '';
                    els[index].appendChild(img);
                    els[index].classList.remove('ad-placeholder');
                    els[index].style.border = 'none';
                    els[index].style.background = 'transparent';
                    els[index].style.padding = '0';
                }
            };

            // Layout mapping for Detail Page:
            // Top Banner -> index 0 of .ad-banner
            if (adsConfig.topBanner) replaceAd('.ad-banner', adsConfig.topBanner, 0);

            // Sidebar 1 -> index 0 of .ad-sidebar
            if (adsConfig.sidebar1) replaceAd('.ad-sidebar', adsConfig.sidebar1, 0);

            // Sidebar 2 -> index 1 of .ad-sidebar
            if (adsConfig.sidebar2) replaceAd('.ad-sidebar', adsConfig.sidebar2, 1);

            // Article Internal Ad (index 1 of .ad-banner) -> Use Top Banner Image or specific
            if (adsConfig.topBanner) replaceAd('.ad-banner', adsConfig.topBanner, 1);

            // Bottom Content Ad (index 2 of .ad-banner)
            if (adsConfig.topBanner) replaceAd('.ad-banner', adsConfig.topBanner, 2);
        }
    </script>

</body>

</html>